# 移动端模型切换按钮修复计划

## 问题诊断

在 `ChatHeader.tsx` 组件中，新建聊天按钮和模型切换按钮被包裹在 `{chatSession && (...)}` 条件中（第 74 行），这意味着这些按钮只有在有活动聊天会话时才会显示。当没有活动聊天会话时，这些按钮不会被渲染，导致用户在移动端看不到它们。

## 解决方案

修改 `ChatHeader.tsx` 组件，使移动端的新建聊天按钮和模型切换按钮始终显示，而不仅仅是在有活动聊天会话时显示。

## 实施步骤

1. **修改 ChatHeader.tsx 组件**

   将第 74-111 行的代码：
   ```tsx
   {chatSession && (
       <>
           <div className="w-64 flex-shrink-0 hidden md:block">
               <ModelSelector models={availableModels} selectedModel={chatSession.model || currentModel} onModelChange={onSetModelForActiveChat} isHeader={true} />
           </div>
           <div className="md:hidden flex items-center gap-1 ml-auto">
               <button onClick={onNewChat} className="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10" data-tooltip={t('newChat')} data-tooltip-placement="left">
                   <Icon icon="plus" className="w-6 h-6" />
               </button>
               <div className="relative" ref={mobileModelSelectorRef}>
                   <button
                       onClick={toggleMobileModelSelector}
                       className="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10"
                       data-tooltip={t('switchModel')}
                       data-tooltip-placement="left"
                   >
                       <Icon icon="chip" className="w-6 h-6" />
                   </button>
                   {isMobileModelSelectorOpen && (
                       <div className="absolute top-16 right-0 z-10 w-48">
                           <div className="glass-pane rounded-[var(--radius-2xl)] p-2 shadow-lg">
                               {availableModels.map(model => (
                                   <div
                                       key={model}
                                       onClick={() => handleMobileModelSelect(model)}
                                       className={`p-2 rounded-lg cursor-pointer flex items-center gap-2 ${(chatSession?.model || currentModel) === model ? 'bg-[var(--accent-color)] text-white' : 'hover:bg-black/10 dark:hover:bg-white/10'}`}
                                   >
                                       <Icon icon="chip" className="w-4 h-4" />
                                       <span className="text-sm">{model}</span>
                                   </div>
                               ))}
                           </div>
                       </div>
                   )}
               </div>
           </div>
       </>
   )}
   ```

   修改为：
   ```tsx
   {/* 桌面端模型选择器 - 只在有聊天会话时显示 */}
   {chatSession && (
       <div className="w-64 flex-shrink-0 hidden md:block">
           <ModelSelector models={availableModels} selectedModel={chatSession.model || currentModel} onModelChange={onSetModelForActiveChat} isHeader={true} />
       </div>
   )}
   
   {/* 移动端按钮 - 始终显示 */}
   <div className="md:hidden flex items-center gap-1 ml-auto">
       <button onClick={onNewChat} className="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10" data-tooltip={t('newChat')} data-tooltip-placement="left">
           <Icon icon="plus" className="w-6 h-6" />
       </button>
       <div className="relative" ref={mobileModelSelectorRef}>
           <button
               onClick={toggleMobileModelSelector}
               className="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10"
               data-tooltip={t('switchModel')}
               data-tooltip-placement="left"
           >
               <Icon icon="chip" className="w-6 h-6" />
           </button>
           {isMobileModelSelectorOpen && (
               <div className="absolute top-16 right-0 z-10 w-48">
                   <div className="glass-pane rounded-[var(--radius-2xl)] p-2 shadow-lg">
                       {availableModels.map(model => (
                           <div
                               key={model}
                               onClick={() => handleMobileModelSelect(model)}
                               className={`p-2 rounded-lg cursor-pointer flex items-center gap-2 ${currentModel === model ? 'bg-[var(--accent-color)] text-white' : 'hover:bg-black/10 dark:hover:bg-white/10'}`}
                           >
                               <Icon icon="chip" className="w-4 h-4" />
                               <span className="text-sm">{model}</span>
                           </div>
                       ))}
                   </div>
               </div>
           )}
       </div>
   </div>
   ```

2. **修改模型选择逻辑**

   在移动端模型选择器中，将 `(chatSession?.model || currentModel) === model` 改为 `currentModel === model`，因为当没有聊天会话时，`chatSession?.model` 为 undefined。

3. **测试修改后的功能**

   - 在没有活动聊天会话时，确保移动端显示新建聊天按钮和模型切换按钮
   - 在有活动聊天会话时，确保移动端和桌面端都正常显示模型选择器
   - 确保模型切换功能正常工作

## 预期结果

修改后，移动端将始终显示新建聊天按钮和模型切换按钮，无论是否有活动聊天会话。这样用户就可以在任何时候访问这些功能，提高了应用的可用性。